@name Afghanit APS ATGM Support V1
@inputs  [Sensor]:entity [FindExcludeOwnProp Active]
@outputs [Ary]:array [ATGM]:entity [CpuUsage Ops] Find
@persist [FindDist FindDelay FindAngle]
@persist [Own]:entity [Range] [ClassAry]:array
@persist 
interval(64)

if (first() | dupefinished()) {
    # ----- User Interface ----- #
    FindDist  = 50
    FindDelay = 0.5
    FindAngle = 50
    
    # ----- Do Not Touch There ----- #
        Own      = owner()
        Range    = 8000
        ClassAry = array("acf_missile", "acf_glatgm")
    
    function entity findMissile() {
        if (FindExcludeOwnProp) {
            findExcludePlayerProps(Own)
        }
        findIncludeClass(ClassAry[1, string])
        findIncludeClass(ClassAry[2, string])
        findSortByDistance(Sensor:pos())
        findInCone(Sensor:pos(), Sensor:forward(), Range, FindAngle)
        Ary  = findToArray()
        ATGM = Ary[1, entity]
        
        return ATGM
    }
    
    function number findDelay() {
        if (FindDelay != 0) {
            timer("Delay", FindDelay * 1000)
            
            if (clk("Delay")) {
                Find = 1
            } else {
                Find = 0
            }
        }
        
        return Find
    }
}

if (Active) {
    findDelay()
    if (Find) {
        findMissile()
    }
}

    CpuUsage = cpuUsage() * 1000000
    Ops      = ops()
    
# Made By RuBid Afghanit APS ATGM Support V1 V2019.07.31
